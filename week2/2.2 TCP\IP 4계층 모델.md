### Internet Protocol Suite

- 인터넷에서 컴퓨터들이 서로 정보를 주고 받는데 쓰이는 프로토콜의 집합
- TCP/IP 4계층이나 OST 7계층 모델로 설명함
- 이러한 계층 모델은 **프로토콜의 네트워킹 범위**에 따라 각 추상화 계층으로 구분됨

# 2.2.1 계층 구조

# TCP/IP 4계층 vs OSI 7계층

| TCP/IP 4계층 | OSI 7계층 |
| --- | --- |
| 애플리케이션 계층 | 애플리케이션 계층 → 브라우저 |
|  | 프레젠테이션 계층 → 인코딩 방식 |
|  | 세션 계층 → 통신관리기법(simplex, half-duplex, full duplex) |
| 전송 계층 | 전송 계층 → TCP, UDP |
| 인터넷 계층 | 네트워크 계층 → IP 주소 |
| 링크 계층 | 데이터링크 계층 → MAC 주소 |
|  | 물리 계층 → 랜선 |
- 특정 계층이 변경된다 하더라도 다른 계층은 영향받지 않도록 설계됨
    - ex) 프로토콜을 TCP → UDP로 변경했다고 해서 웹브라우저를 다시 설치하진 않음

# 애플리케이션 계층

- 서비스를 실질적으로 사용자에게 제공
- ex) FTP, HTTP, SSH, SMTP, DNS 등…

# 전송 계층

- 송신자와 수신자를 연결하는 통신 서비스
- 연결 지향 데이터 스트림 지원, 신뢰성, 흐름 제어

> **TCP**
> 
- **연결 지향 프로토콜** → 연결의 신뢰성 구축
- 패킷 사이의 순서 보장
- 가상회선(Virtual Circuit) 패킷 교환 방식

    ![Untitled](https://github.com/ssafy22-cs-study/cs_study/assets/28949163/be3d408d-5e44-4379-8c76-3a8e7dca1ca0)
    - 특정 경로인 가상회선 등록
    - 각 패킷에 가상회선 식별자가 포함되고, **전송된 순서대로** 도착함
    - 모든 패킷을 전송하면 가상회선 해제
- TCP에서의 신뢰성 확보 과정
    - 3-way handshake : 연결 수립
    
        ![Untitled](https://github.com/ssafy22-cs-study/cs_study/assets/52269983/62362d3c-c243-46df-823a-ae99d3698d23)

        
        - SYN(클라) ⇒ SYN + ACK(서버) ⇒ ACK(클라)
    - 4-way handshake : 연결 해제


      ![Untitled](https://github.com/ssafy22-cs-study/cs_study/assets/52269983/430bbf3c-3ffe-4ba0-b1ec-34555ad0f932)
        
        - FIN(클라) ⇒ ACK(서버) ⇒ FIN(서버) ⇒ (TIME_WAIT 후) ACK(클라)
        - TIME_WAIT : 소켓이 바로 소멸되지 않고 일정시간 유지되는 상태
            - 지연 패킷이 발생하여 데이터 무결성 문제가 발생하는 것을 대비
            - 두 장치가 연결이 닫혔는지 확인하기 위함

> **UDP**
> 
- 단순히 데이터만 주므로 신뢰성 낮음
- 데이터그램 패킷 교환 방식

    ![Untitled](https://github.com/ssafy22-cs-study/cs_study/assets/52269983/aac9a360-85de-4a30-a1b1-221ffd1d39fc)

    

# 인터넷 계층

- 장치로부터 받은 패킷을 수신 대상의 주소를 지정하여 데이터 전달
    - ex) IP, ARP, ICMP
- 비연결형적인 특징
    - 대상이 제대로 받았는지에 대해서는 보장하지 않음

# 링크 계층

- 실질적으로 데이터를 전달하며 장치 간에 신호를 주고받는 규칙을 정하는 계층
    - 예) 전선, 광섬유, 무선 통신 등
- 물리 계층 : 0과 1로 이루어진 데이터를 보내는 계층
- 데이터 링크 계층 : 이더넷 프레임을 통해 에러 확인, 흐름 제어, 접근 제어 담당

> **유선 LAN(IEEE802.3)**
> 
- 전이중화 통신(full-duplex)
    - 송신로와 수신로로 나눠서 데이터를 주고 받음
- 과거에 유선 LAN에 사용한 CSMA/CD 방식
    - 반이중화 통신
    - 데이터를 보낸 이후 충돌이 발생하면 일정 시간 이후 재전송
- **유선 LAN을 이루는 케이블**
    - TP(Twisted Pair) 케이블

       <img width="189" src="https://github.com/ssafy22-cs-study/cs_study/assets/52269983/1ba31ffb-02ae-48a1-9e07-8659bd6ad87a">
        
        - 여덟 개의 구리선을 두 개씩 꼬아서 묶은 케이블
          
          <img width="479" alt="스크린샷 2023-08-27 오후 9 18 38" src="https://github.com/ssafy22-cs-study/cs_study/assets/52269983/e5f95f2a-1ce5-4892-989b-7456785e8800">

            
        - UTP 케이블 : 구리선을 실드처리하지 않고 덮음(흔히 보는 랜선), RJ-45 커넥터
        - STP 케이블 : 실드 처리하고 덮음
    - 광섬유 케이블
        - 레이저를 이용해서 통신 ⇒ 장거리, 고속 통신 가능
        - 내부와 외부를 다른 밀도를 가지는 물질로 제작하여 한 번 들어간 빛이 계속 반사하며 전진
            - 코어(core) : 내부, 빛의 굴절률이 높은 부분
            - 클래딩(cladding) : 외부, 빛의 굴절률이 낮음

> **무선 LAN(IEEE802.11)**
> 
- 수신과 송신에 같은 채널을 사용하기 때문에 반이중화 통신을 사용
- 반이중화 통신(half-duplex)
    - 양쪽 장치가 서로 통신할 수 있으나 동시에 통신할 순 없음
    - 둘 이상의 장치가 동시에 전송하면 충돌 발생 ⇒ 이를 막기 위한 충돌방시 시스템 필요
- CSMA/CA
    - 사전에 충돌을 방지하는 방식 사용
        1. 데이터를 송신하기 전에 무선 매체를 살핌
        2. 캐리어 감지 : 회신이 비어 있는지 판단
        3. IFS(Inter FrameSpace) : 랜덤 값을 기반으로 정해진 시간만큼 기다림, 무선 매체가 사용 중이면 점차 그 간격을 늘려가며 기다림
        4. 이후 데이터 송신
- **무선 LAN을 이루는 주파수**
    - 공기를 매체로 하여 주파수를 쏘아 무선 통신망 구축
    - 2.4GHz
        - 장애물에 강한 특성
        - 전파 간섭이 일어나는 경우가 많음
    - 5GHz
        - 일반적으로 좋은 대역
        - 사용할 수 있는 채널이 많고 동시에 사용할 수 있음 ⇒ 상대적으로 꺠끗한 전파 환경 구축
- 와이파이
    - 전자 기기들이 무선 LAN 신호에 연결할 수 있게 하는 기술
    - 무선 접속 장치(공유기, AP, Access Point)가 필요
        - 유선 LAN에 흐르는 신호를 무선 LAN 신호로 바꿔줌
- BSS(Basic Service Set)
    - BSS 내에 있는 AP들과 장치들이 서로 통신 가능한 구조
    - 근거리 무선 통신을 제공
    - 하나의 AP를 기반으로 구축되어 있음 ⇒ 사용자가 한 곳에서 다른 곳으로 자유롭게 이동하며 네트워크에 접속하는 것이 불가능
- ESS(Extended Service Set)
    - 하나 이상의 연결된 BSS 그룹
    - 장거리 무선 통신을 제공 ⇒ 사용자는 한 장소에서 다른 장소로 이동하며 중단 없이 네트워크에 계속 연결할 수 있음

> **이더넷 프레임**
> 
- 데이터 링크 계층에서 사용하는 캡슐화된 구조

    ![Untitled](https://github.com/ssafy22-cs-study/cs_study/assets/52269983/d26b2488-6845-4608-bbf2-2ddcb93fdd09)
    
- Preamble : 7byte
    - 이더넷 프레임의 시작임을 표시
    - 0과 1의 반복으로 이루어짐
    - 수신기와 송신기의 클록을 동기화할 때 사용
- Start Frame Deleimiter(SFD) : 1byte
    - 실제 프레임이 시작됨을 표시
- DMAC : 6byte
    - 수신지 MAC 주소
- SMAC : 6byte
    - 송신지 MAC 주소
- EtherType : 2byte
    - 값이 1500이하일 경우(length로 사용)
        - Payload의 크기 표시
    - 값이 1536이상일 경우(ethertype으로 사용)
        - 어떤 프로토콜이 캡슐화 되어 있는지 표시(IPv4, IPv6 등)
        - ethertype으로 사용될 경우 payload의 길이는 패킷 간 간격의 위치와 FCS값으로 결정
- Payload
    - 프레임에 담기는 데이터
- CRC(Frame Check Sequence, FCS) : 4byte
    - 에러를 확인하는 비트

# 계층 간 데이터 송수신 과정

> HTTP를 통해 웹 서버에 있는 데이터를 요청한다면?
> 


![Untitled](https://github.com/ssafy22-cs-study/cs_study/assets/52269983/d5913c1e-76dc-4cc6-9b4d-f1e26563e138)


1. 클라이언트의 request가 캡슐화 과정을 거쳐 애플리케이션 계층 → 링크 계층으로 내려감
2. 링크 계층을 통해 서버와 통신함
3. 서버의 링크계층 → 애플리케이션 계층으로 비캡슐화를 거치며 올라감
4. 서버의 애플리케이션 계층에서 데이터를 받음

> 캡슐화 과정
> 

![Untitled](https://github.com/ssafy22-cs-study/cs_study/assets/52269983/2184a0bd-3623-406f-a144-e716c03f0397)

- 상위 계층의 헤더를 하위 계층의 데이터 부분에 포함시키고 해당 계층의 헤더를 삽입함
1. 애플리케이션 → 전송
    - 세그먼트(TCP)/데이터그램(UDP) 화
    - **TCP(L4) 헤더** 붙음
2. 전송 → 인터넷
    - 패킷 화
    - **IP(L3) 헤더** 붙음
3. 인터넷 → 링크
    - 프레임 화
    - **프레임 헤더**가 붙고 **프레임 트레일러**로 감싼다

> 비캡슐화 과정
> 
- 캡슐화의 역순
- 최종적으로 송신자는 **애플리케이션 계층의 PDU**인 **메시지**를 전달 받음

# 2.2.2 PDU

- Protocol Data Unit
- 네트워크의 어떠한 계층에서 계층으로 데이터가 전달될 때 한 덩어리의 단위

> PDU의 종류
> 
- 애플리케이션 계층 : 메시지
- 전송 계층 : 세그먼트(TCP), 데이터그램(UDP)
- 인터넷 계층 : 패킷
- 링크 계층 : 프레임(데이터 링크 계층), 비트(물리 계층)

# 살펴보기

- curl 명령어를 통해 response 헤더 값을 볼 수 있는데 모두 문자열이다
- 가장 하위 계층인 물리계층의 PDU인 비트기반으로 송수신하는게 제일 빠르고 효율적이지만 애플리케이션 계층에서 사용자가 편하게 해석, 확장하기 위해서는 문자열을 기반으로 하므로 계층별로 구분한다
