# 2.4 IP 주소

## 2.4.1 ARP (Address Resolution Protocol = 주소 결정 프로토콜)

- 네트워크 상에서 IP 주소를 MAC 주소로 대응(bind)시키기 위해 사용되는 프로토콜

> [MAC 주소?](https://ko.wikipedia.org/wiki/MAC_%EC%A3%BC%EC%86%8C) (Media Access Control)
> 
- 이더넷과 와이파이를 포함한 대부분의 네트워크 기술에 주소로 사용되는 48비트 고유 식별자로 물리적 네트워크 주소라고도 함

![Untitled](https://github.com/ssafy22-cs-study/cs_study/assets/52269983/76d62889-63ce-4337-9f02-7803ae355bb2)


> 동작 과정
> 
1. 통신하고자 하는 두 단말이 **같은 네트워크**에 있을 때
    - 각 단말의 MAC 주소는 중계 장치(ex. 허브, 스위치 등)가 MAC 주소 테이블 정보를 저장하고 관리하여, 내부에서 MAC 주소를 가지고 통신
    
    ![Untitled](https://github.com/ssafy22-cs-study/cs_study/assets/52269983/c3317c3c-5dfc-4371-87ac-3c8dd4912903)
    
2. 통신하고자 하는 두 단말이 **다른 네트워크**에 있을 때
    - A가 자신과 같은 네트워크 대역에 ARP 요청 (혹시 B 아니?)
    - 중계 장치는 몰라서 네트워크 게이트웨이를 목적지로 해서 A의 요청을 broadcast
        - 중계장치는 일단 B를 FF:FF:FF:FF:FF:FF 로 기록(기본 게이트웨이)
    - ARP 요청을 라우터가 받음
        - 라우터도 일단 B를 몰라서 자기 MAC 주소를 알려줌
    - A가 라우터의 MAC 주소를 받아서 다시 요청 (B 아니?)
    - 라우터는 다시 해당 네트워크 대역에 broadcast
    - B 단말이 자신의 IP 주소가 기록된 패킷을 보고 응답 (ARP reply: Unicast)
    - A - B 통신 시작

    ![Untitled](https://github.com/ssafy22-cs-study/cs_study/assets/52269983/9ed7a1e1-7024-4893-b15d-2b4f15457e0a)
    
    ⇒ IP 주소를 통해 여러개의 라우터를 건너가는 모습
    
    ⇒ IP 주소를 통해 통신하는 과정을 **홉바이홉 통신** 이라고 함
    
    > 브로드캐스트
    > 
    
    송신 호스트가 전송한 데이트가 네트워크에 연결된 모든 호스트에 전송되는 방식
    
    > 유니캐스트
    > 
    
    고유 주소로 식별된 하나의 네트워크 목적지에 1:1로 데이터를 전송하는 방식
    
    ## 2.4.2 홉바이홉 통신 (위에서 설명)
    
    > 라우팅
    > 
    
    IP 주소를 찾아가는 과정
    
    ### 라우팅 테이블
    
    - 송신지에서 수신지까지 도달하기 위해 사용
    - 라우터에 들어가 있는 목적지 정보들과 그 목적지로 가기 위한 방법이 들어있는 리스트
    - 해당 목적지까지 가기 위해 거쳐야 할 다음 라우터의 정보를 가지고 있음
    
    ### 게이트웨이
    
    - 서로 다른 통신망, 프로토콜을 사용하는 네트워크 간의 통신을 가능하게 하는 관문 역할을 하는 컴퓨터나 소프트웨어
    - 확인 방법
        - 라우팅 테이블을 통해 볼 수 있음
        - 라우팅 테이블 확인 명령어 : netstat -r
    
    ## 2.4.3 IP 주소 체계
    
    - IP 주소는 IPv4 와 IPv6로 나뉜다.
    - IPv4: 32비트를 8비트 단위로 점을 찍어 표기 (가장 많이 쓰이는 주소 체계)
    - IPv6: 64비트를 16비트 단위로 점을 찍어 표기 (로 가자는 분위기)
    
    설명은 IPv4가 기준!
    
    ### IP 주소의 구조
    
    - 32비트의 길이로 구성된 논리적인 주소 체계
    - 우리가 흔히 아는 127.0.0.1 과 같은 형태는 보기 좋게하려고 원래의 IP(2진수 형태)를 10진수로 표기한 것
    - 원래는 00000000.00000000.00000000.00000000 의 형태
    - 한 구역이 전부 1이라면 10진수 변환시 255
    
    ⇒ 따라서 각 구역은 0~255 범위를 가짐
    
    ### 클래스 기반 할당 방식

    ![Untitled](https://github.com/ssafy22-cs-study/cs_study/assets/52269983/15bd33c2-94ad-4f7e-924e-9529ccce1c5f)
    
    먼저 네트워크 ID 와 호스트 ID 를 알아야 함
    
    > Network ID
    > 
    
    인터넷 상에서 모든 host 들을 전부 관리하기 힘들기 때문에 한 네트워크의 범위를 지정하여 관리하기 쉽게 만든 것
    
    > Host ID
    > 
    
    호스트를 개별 관리하기 위해 사용
    
    > 클래스 기반 할당 방식
    > 
    - A, B, C, D, E 이렇게 다섯개의 클래스로 구분하는 방식
    - 앞의 부분을 네트워크 주소, 그 뒤를 컴퓨터에 부여하는 호스트 주소로 사용
    - 클래스A, B, C는 일대일 통신
    - 클래스 D는 멀티캐스트 통신
    - 클래스 E는 앞으로 사용할 예비용

    ![Untitled](https://github.com/ssafy22-cs-study/cs_study/assets/52269983/6828d1fe-af56-4857-8337-9b6b3f1b4c90)
    
    1. 클래스 A
        1. 처음 1바이트(8비트) 가 네트워크 주소, 나머지 3바이트(24비트)는 호스트 주소
        2. 맨 왼쪽 구분 비트가 0으로 시작하여 0~127 네트워크 할당
    2. 클래스 B
        1. 처음 2바이트(16비트) 가 네트워크 주소, 나머지 2바이트(16비트)는 호스트 주소
        2. 맨 왼쪽 구분 비트가 10으로 시작하여 128~191 네트워크 할당
    3. 클래스 C
        1. 처음 3바이트(24비트) 가 네트워크 주소, 나머지 1바이트(8비트)는 호스트 주소
        2. 맨 왼쪽 구분 비트가 110으로 시작하여 192~223 네트워크 할당
    
    > 이제 주소를 다시 보자
    > 
    ![Untitled](https://github.com/ssafy22-cs-study/cs_study/assets/52269983/838f268d-eb84-4a70-a39c-4e03dcab9875)
    
    네트워크 구별 주소는 가장 첫번째 주소이며, 네트워크 주소로 사용.
    
    → 클래스 A의 120.0.0.0 이라는 네트워크를 부여받은 경우, 120.0.0.0 이 네트워크 구별 주소.
    
    호스트 주소는 첫번째 주소와 마지막 주소를 제외한 나머지 주소를 말하며, 컴퓨터에 부여할 수 있는 주소.
    
    → 120.0.0.1 ~ 120.255.255.254 가 해당
    
    브로드캐스트 주소는 가장 마지막 주소를 말하며, 네트워크에 속해 있는 모든 컴퓨터에 데이터를 보내는 주소
    
    → 120.255.255.255
    
    ⇒ 하지만 결국 클래스 기반 할당 방식은 `사용하는 주소보다 버리는 주소가 많은 단점`으로 인해 과거로 사라지고.... 
    
    ⇒ 이를 해결하기 위해 DHCP 와 IPv6, NAT 가 등장
    

### DHCP (Dynamic Host Configuration Protocol = 동적 호스트 구성 프로토콜)

- DHCP는 IP 주소 및 기타 통신 매개변수를 네트워크에 연결된 장치에 자동으로 할당
- 대부분의 가정용 네트워크에서는 라우터가 IP 주소를 장치에 할당하는 DHCP 서버의 역할
- DHCP는 네트워크 관리자가 해야 할 작업을 간소화

> 장점
> 
- 신뢰성 높은 DHCP IP 주소 구성 (동일한 IP 주소를 사용하는 이용자 사이의 충돌 방지)
- 높은 이동성 (네트워크 범위 내에서 어디서든지 모바일 장치 이용 가능)
- 효율적인 네트워크 관리 (별도의 IP 할당 서버가 필요하지 않아 네트워크 관리 효율성이 개선)
- IP 체계의 유연성 (최종 사용자에게 지장을 주지 않으면서 IP 주소 체계를 손쉽게 변경 가능)

> 단점
> 
- 아무런 인증 과정을 거치지 않기 때문에 사이버 공격에 취약
- DHCP 서버에 의존되기 때문에 서버가 다운되면 IP 할당이 제대로 이루어지지 않음

> 구성
> 
1. DHCP 서버
    1. 네트워크 인터페이스를 위해서 IP주소를 가지고 있는 서버에서 실행되는 프로그램
    2. 일정한 범위의 IP주소를 다른 클라이언트에게 할당하여 자동으로 설정하게 해주는 역할
    
    ⇒ 클라이언트에게 IP 할당 요청이 들어오면 IP 를 부여, 할당 가능한 IP들을 관리
    
2. DHCP 클라이언트
    1. 시스템이 시작하면 DHCP서버에 자신의 시스템을 위한 IP주소를 요청
    2. IP주소를 받으면 TCP/IP 설정은 초기화, 다른 호스트와 TCP/IP를 사용해서 통신이 가능하게 됨

> DHCP 원리
> 
- DHCP를 통한 IP 주소 할당은 “임대”라는 개념
- 이는 IP 주소를 영구적으로 할당하는 것이 아닌, 임대기간(IP Lease Time)을 명시하여 그 기간 동안만 IP 주소를 사용하도록 하는 것
- 단말(클라이언트)은 IP 주소 임대기간을 연장(IP Address Renewal) 가능
- 단말은 또한, IP 주소가 더이상 필요하지 않게 되면 IP 주소 반납 절차(IP Address Release) 수행

### NAT (Network Address Translation)

패킷이 라우팅 장치를 통해 전송되는 동안 패킷의 IP 주소 정보를 수정하여 IP 주소를 다른 주소로 매핑하는 방법

⇒ IPv4 만으로는 많은 주소들을 모두 감당할 수 없기에, 이를 해결하기 위해 NAT 로 공인 IP 와 사설 IP 로 나눠서 많은 주소를 처리한다

⇒ 사설 IP 를 공인 IP 로 변환

⇒ 사설 호스트에 접속할 때 공인 IP 로 변환

![Untitled](https://github.com/ssafy22-cs-study/cs_study/assets/52269983/21112994-9e03-47d3-ab50-113da41719eb)

## 2.4.4 IP 주소를 이용한 위치 정보

IP 주소는 인터넷에서 사용하는 네트워크 주소이기 때문에 이를 통해 동 또는 구까지 위치 추적이 가능하다.
